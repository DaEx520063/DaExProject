<div class="container-fluid">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h2><i class="fas fa-car text-primary"></i> ระบบจัดการรถบริษัท</h2>
                    <p class="text-muted">จัดการและติดตามรถบริษัททั้งหมด</p>
                </div>
                <div>
                    <button class="btn btn-primary" onclick="window.location.href='/vehicle/dashboard'">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card stat-card">
                <div class="card-body text-center">
                    <i class="fas fa-car fa-3x text-primary mb-3"></i>
                    <h5>ลงทะเบียนใช้งานรถ</h5>
                    <p class="text-muted">บันทึกการใช้งานรถประจำวัน</p>
                    <button class="btn btn-outline-primary" onclick="window.location.href='/vehicle/register'">
                        <i class="fas fa-plus"></i> ลงทะเบียน
                    </button>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card stat-card">
                <div class="card-body text-center">
                    <i class="fas fa-tools fa-3x text-warning mb-3"></i>
                    <h5>ตรวจเช็คสภาพรถ</h5>
                    <p class="text-muted">ตรวจเช็คสภาพรถประจำสัปดาห์</p>
                    <button class="btn btn-outline-warning" onclick="window.location.href='/vehicle/check'">
                        <i class="fas fa-clipboard-check"></i> ตรวจเช็ค
                    </button>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card stat-card">
                <div class="card-body text-center">
                    <i class="fas fa-list fa-3x text-info mb-3"></i>
                    <h5>รายการรถบริษัท</h5>
                    <p class="text-muted">ดูรายการรถและประวัติซ่อมบำรุง</p>
                    <button class="btn btn-outline-info" onclick="window.location.href='/vehicle/list'">
                        <i class="fas fa-eye"></i> ดูรายการ
                    </button>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card stat-card">
                <div class="card-body text-center">
                    <i class="fas fa-gas-pump fa-3x text-success mb-3"></i>
                    <h5>ประวัติเบิกจ่ายน้ำมัน</h5>
                    <p class="text-muted">ติดตามการใช้จ่ายน้ำมัน</p>
                    <button class="btn btn-outline-success" onclick="window.location.href='/vehicle/fuel'">
                        <i class="fas fa-chart-line"></i> ดูประวัติ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Statistics -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card stat-card">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h6 class="mb-0">รถทั้งหมด</h6>
                            <h3 class="mb-0" id="totalVehicles">0 คัน</h3>
                        </div>
                        <i class="fas fa-car fa-2x opacity-75"></i>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card stat-card">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h6 class="mb-0">รถใช้งาน</h6>
                            <h3 class="mb-0" id="activeVehicles">0 คัน</h3>
                        </div>
                        <i class="fas fa-check-circle fa-2x opacity-75"></i>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card stat-card">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h6 class="mb-0">รอซ่อม</h6>
                            <h3 class="mb-0" id="maintenanceVehicles">0 คัน</h3>
                        </div>
                        <i class="fas fa-tools fa-2x opacity-75"></i>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card stat-card">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h6 class="mb-0">ค่าใช้จ่ายน้ำมันเดือนนี้</h6>
                            <h3 class="mb-0" id="monthlyFuelCost">0 บาท</h3>
                        </div>
                        <i class="fas fa-gas-pump fa-2x opacity-75"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Activities -->
    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-history"></i> กิจกรรมล่าสุด</h5>
                </div>
                <div class="card-body">
                    <div id="recentActivities">
                        <!-- Activities will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-bell"></i> การแจ้งเตือน</h5>
                </div>
                <div class="card-body">
                    <div id="notifications">
                        <!-- Notifications will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Load vehicle management data
document.addEventListener('DOMContentLoaded', function() {
    loadVehicleStats();
    loadRecentActivities();
    loadNotifications();
});

function loadVehicleStats() {
    fetch('/api/vehicle/dashboard-stats')
        .then(response => response.json())
        .then(data => {
            document.getElementById('totalVehicles').textContent = data.total_vehicles + ' คัน';
            document.getElementById('activeVehicles').textContent = data.active_vehicles + ' คัน';
            document.getElementById('maintenanceVehicles').textContent = data.maintenance_vehicles + ' คัน';
            document.getElementById('monthlyFuelCost').textContent = data.monthly_fuel_cost + ' บาท';
        })
        .catch(error => {
            console.error('Error loading vehicle stats:', error);
        });
}

function loadRecentActivities() {
    fetch('/api/vehicle/recent-activities')
        .then(response => response.json())
        .then(data => {
            const container = document.getElementById('recentActivities');
            
            if (data.length === 0) {
                container.innerHTML = '<p class="text-muted">ไม่มีกิจกรรมล่าสุด</p>';
                return;
            }
            
            container.innerHTML = data.map(activity => `
                <div class="activity-item">
                    <div class="d-flex justify-content-between">
                        <div>
                            <strong>${activity.description}</strong>
                            <br>
                            <small class="text-muted">โดย: ${activity.user}</small>
                        </div>
                        <small class="text-muted">${activity.date}</small>
                    </div>
                </div>
            `).join('');
        })
        .catch(error => {
            console.error('Error loading recent activities:', error);
        });
}

function loadNotifications() {
    fetch('/api/vehicle/notifications')
        .then(response => response.json())
        .then(data => {
            const container = document.getElementById('notifications');
            
            if (data.length === 0) {
                container.innerHTML = '<p class="text-muted">ไม่มีการแจ้งเตือน</p>';
                return;
            }
            
            container.innerHTML = data.map(notification => `
                <div class="alert alert-${getPriorityClass(notification.priority)} alert-sm">
                    <h6 class="alert-heading">${notification.title}</h6>
                    <p class="mb-1">${notification.message}</p>
                    <small class="text-muted">
                        รถ: ${notification.vehicle} | วันที่: ${notification.due_date}
                    </small>
                </div>
            `).join('');
        })
        .catch(error => {
            console.error('Error loading notifications:', error);
        });
}

function getPriorityClass(priority) {
    switch(priority) {
        case 'high': return 'danger';
        case 'medium': return 'warning';
        case 'low': return 'info';
        default: return 'secondary';
    }
}
</script>
